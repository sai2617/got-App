<div class="book-detail-container">
  <div *ngIf="!selectedBook" class="no-selection">
    <div class="placeholder">
      <app-loading></app-loading>
      <div class="placeholder-icon">ğŸ“š</div>
      <h2>Choose Your Journey</h2>
      <p>Please select a book from the collection to discover its secrets and characters.</p>
    </div>
  </div>

  <div *ngIf="selectedBook" class="book-detail">
    <header class="book-header">
      <div class="book-cover-large">
        <div class="cover-spine"></div>
        <div class="cover-title">{{ selectedBook.name.split(' ').slice(0, 2).join(' ') }}</div>
      </div>
      <div class="book-title-section">
        <h1 class="book-title">{{ selectedBook.name }}</h1>
        <p class="book-author">by {{ selectedBook.authors.join(', ') }}</p>
      </div>
    </header>

    <section class="book-info">
      <div class="info-grid">
        <div class="info-card">
          <div class="info-icon">ğŸ“–</div>
          <label>Pages</label>
          <span>{{ selectedBook.numberOfPages | number }}</span>
        </div>
        <div class="info-card">
          <div class="info-icon">ğŸ›ï¸</div>
          <label>Publisher</label>
          <span>{{ selectedBook.publisher }}</span>
        </div>
        <div class="info-card">
          <div class="info-icon">ğŸŒ</div>
          <label>Country</label>
          <span>{{ selectedBook.country }}</span>
        </div>
        <div class="info-card">
          <div class="info-icon">ğŸ“…</div>
          <label>Released</label>
          <span>{{ selectedBook.released | date:'MMM dd, yyyy' }}</span>
        </div>
        <div class="info-card" *ngIf="selectedBook.isbn">
          <div class="info-icon">ğŸ”¢</div>
          <label>ISBN</label>
          <span>{{ selectedBook.isbn }}</span>
        </div>
        <div class="info-card">
          <div class="info-icon">ğŸ“±</div>
          <label>Format</label>
          <span>{{ selectedBook.mediaType }}</span>
        </div>
      </div>
    </section>

    <section class="characters-section">
      <div class="section-header">
        <h2>Characters in This Tale</h2>
        <div class="character-count" *ngIf="characters.length > 0">
          {{ characters.length }} characters revealed
        </div>
      </div>

      <app-loading *ngIf="isLoadingCharacters"></app-loading>

      <div *ngIf="!isLoadingCharacters && characters.length > 0" class="characters-grid">
        <div
          class="character-card"
          *ngFor="let character of characters; trackBy: trackByUrl"
          (click)="openCharacterModal(character)"
        >
          <div class="character-avatar">
            <div class="avatar-placeholder">
              {{ (character.name || 'Unknown').charAt(0).toUpperCase() }}
            </div>
          </div>
          <div class="character-info">
            <h3 class="character-name">
              {{ character.name || 'Unnamed Character' }}
            </h3>
            <div class="character-details">
              <span *ngIf="character.titles.length > 0" class="character-title">
                {{ character.titles[0] }}
              </span>
              <span *ngIf="character.culture" class="character-culture">
                of {{ character.culture }}
              </span>
            </div>
          </div>
          <div class="character-status">
            <span class="status-indicator" [class.noble]="character.titles.length > 0 || character.allegiances.length > 0">
              {{ character.titles.length > 0 || character.allegiances.length > 0 ? 'Noble' : 'Common' }}
            </span>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoadingCharacters && characters.length === 0" class="no-characters">
        <div class="empty-state">
          <div class="empty-icon">ğŸ‘¥</div>
          <p>No character information available for this tome.</p>
        </div>
      </div>
    </section>
  </div>
</div>
